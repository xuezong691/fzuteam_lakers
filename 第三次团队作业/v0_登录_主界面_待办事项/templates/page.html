<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ç³»ç»Ÿä¸»ç•Œé¢</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='todotask.css') }}">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: "Segoe UI", "Microsoft YaHei", sans-serif;
    }

    body {
      display: flex;
      min-height: 100vh;
      background-color: #f8f9fa;
    }

    /* ========== å·¦ä¾§è¾¹æ  ========== */
    .sidebar {
      width: 240px;
      background: #2c3e50;
      color: white;
      display: flex;
      flex-direction: column;
      box-shadow: 2px 0 10px rgba(0,0,0,0.1);
      position: fixed;
      height: 100vh;
      overflow-y: auto;
    }

    .logo-container {
      padding: 20px;
      border-bottom: 1px solid #34495e;
    }

    .logo {
      font-size: 24px;
      font-weight: bold;
      color: #3498db;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .logo img {
      width: 36px;
      height: 36px;
      background: #3498db;
      border-radius: 6px;
    }

    .nav-links {
      padding: 20px 0;
      list-style: none;
    }

    .nav-links li {
      padding: 12px 24px;
      cursor: pointer;
      transition: background 0.2s, color 0.2s;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .nav-links li:hover,
    .nav-links li.active {
      background: #34495e;
      color: #3498db;
    }

    .nav-links li i {
      font-size: 18px;
      width: 24px;
      text-align: center;
    }

    /* ========== ä¸»å†…å®¹åŒº ========== */
    .main-content {
      flex: 1;
      margin-left: 240px;
      padding: 30px;
      background: #ffffff;
    }

    .page {
      display: none;
      animation: fadeIn 0.4s ease-in-out;
    }

    .page.active {
      display: block;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    h2 {
      margin-bottom: 20px;
      color: #2c3e50;
    }

    .page-content {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 8px;
      min-height: 500px;
    }

    /* å“åº”å¼ï¼šå°å±éšè—ä¾§è¾¹æ ï¼ˆå¯é€‰ï¼‰ */
    @media (max-width: 768px) {
      .sidebar {
        width: 70px;
      }
      .sidebar .logo span,
      .sidebar .nav-links li span {
        display: none;
      }
      .main-content {
        margin-left: 70px;
      }
    }
  </style>
</head>
<body>

  <!-- å·¦ä¾§å¯¼èˆªæ  -->
  <div class="sidebar">
    <div class="logo-container">
      <div class="logo">
        <span>ä½ å¥½ï¼å°åŠåŒå­¦</span>
      </div>
    </div>
    <ul class="nav-links" id="navLinks">

      <li data-page="dashboard" class="active">
        <span>ğŸ’¡</span>
        <span>AIåŠ©æ‰‹</span>
      </li>

      <li data-page="data">
        <span>ğŸ§‘â€ğŸ’¼</span>
        <span>æˆå‘˜æ•°æ®</span>
      </li>

      <li data-page="meeting">
        <span>ğŸ“„</span>
        <span>ä¼šè®®åŠ©æ‰‹</span>
      </li>

      <li data-page="task_generater">
        <span>ğŸ§©</span>
        <span>æ™ºèƒ½ä»»åŠ¡åˆ†è§£</span>
      </li>

      <li data-page="todotask">
        <span>ğŸ“</span>
        <span>äº‹é¡¹çœ‹æ¿</span>
      </li>

    </ul>
  </div>

  <!-- å³ä¾§å†…å®¹åŒº -->
  <div class="main-content">
    <!-- AIèŠå¤© -->
    <div class="page active" id="page-dashboard">
      <h2>ğŸ’¡ æ¥å’Œå¤§æ¨¡å‹èŠå¤©</h2>
      <div class="page-content">
        <p>æ¬¢è¿ä½¿ç”¨ç³»ç»Ÿï¼è¿™é‡Œæ˜¯ä¸»æ§åˆ¶é¢æ¿ã€‚</p>
        <p>ä½ å¯ä»¥æŸ¥çœ‹ç³»ç»ŸçŠ¶æ€ã€ä»»åŠ¡è¿›åº¦ç­‰å…³é”®ä¿¡æ¯ã€‚</p>
      </div>
    </div>

    <!-- å›¢é˜Ÿæˆå‘˜ -->
    <div class="page" id="page-data">
      <h2>ğŸ§‘â€ğŸ’¼ å›¢é˜Ÿæˆå‘˜æ•°æ®</h2>
      <div class="page-content">
        <p>åœ¨æ­¤æ¨¡å—è¿›è¡Œæ•°æ®å¯¼å…¥ã€æ¸…æ´—ä¸å¯è§†åŒ–åˆ†æã€‚</p>
        <button style="margin-top: 10px;">ä¸Šä¼ æ•°æ®æ–‡ä»¶</button>
      </div>
    </div>

    <!-- ä¼šè®®åŠ©æ‰‹ -->
    <div class="page" id="page-meeting">
      <h2>ğŸ“„ ä¼šè®®è¯­è¨€è½¬æ–‡å­—ã€è¯­è¨€ä¸€é”®ç”Ÿæˆæ‘˜è¦</h2>
      <div class="page-content">
        <p>è‡ªåŠ¨ç”Ÿæˆå‘¨æŠ¥ã€æœˆæŠ¥æˆ–è‡ªå®šä¹‰æŠ¥å‘Šã€‚</p>
        <select style="margin-top: 10px; padding: 5px;">
          <option>é€‰æ‹©æŠ¥å‘Šç±»å‹</option>
          <option>å‘¨æŠ¥</option>
          <option>æœˆæŠ¥</option>
        </select>
      </div>
    </div>

    <!-- æ™ºèƒ½ä»»åŠ¡åˆ†è§£ -->
<div class="page" id="page-task_generater">
  <h2>ğŸ§© æ™ºèƒ½ä»»åŠ¡åˆ†è§£</h2>
  <div class="page-content">
    <div class="task-generator-wrapper">
      <!-- ä»»åŠ¡è¾“å…¥åŒºåŸŸ -->
      <div class="input-section">
        <div class="task-form-field full">
          <label for="taskInput">è¾“å…¥éœ€è¦åˆ†è§£çš„ä»»åŠ¡æˆ–ç›®æ ‡ï¼š</label>
          <textarea
            id="taskInput"
            name="taskInput"
            rows="4"
            placeholder="ä¾‹å¦‚ï¼šå¼€å‘ä¸€ä¸ªåœ¨çº¿è´­ç‰©ç½‘ç«™ã€ç»„ç»‡ä¸€æ¬¡å›¢é˜Ÿå»ºè®¾æ´»åŠ¨ã€å®Œæˆå­£åº¦é”€å”®ç›®æ ‡..."
            required
          ></textarea>
        </div>
        
        <div class="task-form-row">
          <div class="task-form-field">
            <label for="taskComplexity">ä»»åŠ¡å¤æ‚åº¦</label>
            <select id="taskComplexity" name="complexity">
              <option value="simple">ç®€å•</option>
              <option value="medium" selected>ä¸­ç­‰</option>
              <option value="complex">å¤æ‚</option>
            </select>
          </div>
          <div class="task-form-field">
            <label for="taskDeadline">æœŸæœ›å®Œæˆæ—¶é—´ï¼ˆå¤©ï¼‰</label>
            <input
              type="number"
              id="taskDeadline"
              name="deadline"
              min="1"
              max="365"
              value="7"
              placeholder="ä¾‹å¦‚ï¼š7"
            />
          </div>
        </div>
        
        <div class="task-form-actions">
          <button type="button" id="btnGenerateTasks" class="btn-primary">
            ğŸ§© æ™ºèƒ½åˆ†è§£ä»»åŠ¡
          </button>
        </div>
      </div>

      <!-- åŠ è½½çŠ¶æ€ -->
      <div id="loadingSection" class="loading-section" style="display: none;">
        <div class="loading-spinner"></div>
        <p>AIæ­£åœ¨åˆ†æå¹¶åˆ†è§£æ‚¨çš„ä»»åŠ¡...</p>
      </div>

      <!-- ç»“æœå±•ç¤ºåŒºåŸŸ -->
      <div id="resultSection" class="result-section" style="display: none;">
        <h3>ğŸ“‹ åˆ†è§£åçš„å­ä»»åŠ¡</h3>
        <div id="generatedTasks" class="generated-tasks">
          <!-- ç”Ÿæˆçš„å­ä»»åŠ¡å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
        </div>
        
        <div class="result-actions">
          <button type="button" id="btnSaveTasks" class="btn-primary">
            ğŸ’¾ ä¿å­˜åˆ°äº‹é¡¹çœ‹æ¿
          </button>
          <button type="button" id="btnRegenerate" class="btn-secondary">
            ğŸ”„ é‡æ–°ç”Ÿæˆ
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

    <!-- äº‹é¡¹çœ‹æ¿ -->
    <div class="page" id="page-todotask">
      <h2>ğŸ“ äº‹é¡¹çœ‹æ¿</h2>
      <div class="page-content">
        <div class="todo-wrapper">
          <!-- é¡¶éƒ¨ï¼šæ ‡é¢˜ + åˆ·æ–°æŒ‰é’® -->
          <div class="todo-header">
            <div>
              <h3>å›¢é˜Ÿå¾…åŠäº‹é¡¹</h3>
              <p class="todo-subtitle">æ ¹æ®å½“å‰ç™»å½•ç”¨æˆ·åŠ è½½ä»»åŠ¡</p>
            </div>
            <div class="todo-actions">
              <button type="button" id="btnRefreshTasks" class="btn-secondary">
                åˆ·æ–°ä»»åŠ¡
              </button>
            </div>
          </div>

          <!-- æ·»åŠ ä»»åŠ¡è¡¨å• -->
          <form id="taskForm" class="task-form">
            <div class="task-form-row">
              <div class="task-form-field">
                <label for="taskTime">æ—¥æœŸ</label>
                <input type="date" id="taskTime" name="time" required />
              </div>
              <div class="task-form-field">
                <label for="taskPlace">åœ°ç‚¹</label>
                <input
                  type="text"
                  id="taskPlace"
                  name="place"
                  placeholder="ä¾‹å¦‚ï¼šå®éªŒå®¤A"
                />
              </div>
            </div>

            <div class="task-form-row">
              <div class="task-form-field">
                <label for="taskStaff">è´Ÿè´£äºº</label>
                <input
                  type="text"
                  id="taskStaff"
                  name="staff"
                  placeholder="ä¾‹å¦‚ï¼šå¼ ä¸‰"
                />
              </div>
              <div class="task-form-field">
                <label for="taskUrgency">ç´§æ€¥ç¨‹åº¦</label>
                <select id="taskUrgency" name="urgency">
                  <option value="1">ä¸€èˆ¬</option>
                  <option value="2">é‡è¦</option>
                  <option value="3">ç´§æ€¥</option>
                </select>
              </div>
            </div>

            <div class="task-form-row">
              <div class="task-form-field full">
                <label for="taskSomething">ä»»åŠ¡å†…å®¹</label>
                <textarea
                  id="taskSomething"
                  name="something"
                  rows="2"
                  placeholder="éœ€è¦å®Œæˆçš„äº‹é¡¹..."
                  required
                ></textarea>
              </div>
            </div>

            <div class="task-form-actions">
              <button type="submit" class="btn-primary">
                æ·»åŠ ä»»åŠ¡
              </button>
            </div>
          </form>

          <!-- ä»»åŠ¡å¡ç‰‡å®¹å™¨ -->
          <div id="taskBoard" class="task-board">
            <p class="task-empty">
              ç›®å‰è¿˜æ²¡æœ‰ä»»åŠ¡ï¼Œç‚¹å‡»ä¸Šæ–¹â€œåˆ·æ–°ä»»åŠ¡â€ä»åç«¯åŠ è½½æ•°æ®ï¼Œæˆ–è€…å…ˆæ·»åŠ ä¸€æ¡ä»»åŠ¡ã€‚
            </p>
          </div>
        </div>
      </div>
    </div>

  </div>

    <script>
    // è·å–å½“å‰ç™»å½•ç”¨æˆ·çš„ userIdï¼ˆç™»å½•æ—¶å†™å…¥ localStorageï¼‰
    function getCurrentUserId() {
      return localStorage.getItem("userId");
    }

    // æ¸²æŸ“ä»»åŠ¡åˆ—è¡¨ä¸ºå¡ç‰‡
    function renderTasks(tasks) {
      var board = document.getElementById("taskBoard");
      if (!board) return;

      board.innerHTML = "";

      if (!tasks || tasks.length === 0) {
        var empty = document.createElement("p");
        empty.className = "task-empty";
        empty.textContent = "æ²¡æœ‰ä»»åŠ¡ï¼Œè¯•è¯•æ·»åŠ ä¸€æ¡æˆ–ç‚¹å‡»â€œåˆ·æ–°ä»»åŠ¡â€ã€‚";
        board.appendChild(empty);
        return;
      }

      tasks.forEach(function (task) {
        var card = document.createElement("div");
        card.className = "task-card";

        var title = document.createElement("div");
        title.className = "task-title";
        title.textContent = task.something || "æœªå¡«å†™ä»»åŠ¡å†…å®¹";

        var meta = document.createElement("div");
        meta.className = "task-meta";

        var timeSpan = document.createElement("span");
        timeSpan.textContent = "æ—¥æœŸï¼š" + (task.time || "-");

        var placeSpan = document.createElement("span");
        placeSpan.textContent = "åœ°ç‚¹ï¼š" + (task.place || "-");

        var staffSpan = document.createElement("span");
        staffSpan.textContent = "è´Ÿè´£äººï¼š" + (task.staff || "-");

        meta.appendChild(timeSpan);
        meta.appendChild(placeSpan);
        meta.appendChild(staffSpan);

        var content = document.createElement("div");
        content.className = "task-content";
        content.textContent = task.something || "";

        var footer = document.createElement("div");
        footer.className = "task-footer";

        var urgencySpan = document.createElement("span");
        urgencySpan.className = "task-urgency";
        urgencySpan.textContent = "ç´§æ€¥ç¨‹åº¦ï¼š" + (task.urgency || 1);

        var deleteBtn = document.createElement("button");
        deleteBtn.type = "button";
        deleteBtn.className = "task-delete-btn";
        deleteBtn.textContent = "åˆ é™¤";
        deleteBtn.setAttribute("data-id", task.id);

        footer.appendChild(urgencySpan);
        footer.appendChild(deleteBtn);

        card.appendChild(title);
        card.appendChild(meta);
        // card.appendChild(content);
        card.appendChild(footer);

        board.appendChild(card);
      });
    }

    // è°ƒç”¨ /api/task/refresh è·å–ä»»åŠ¡åˆ—è¡¨
    async function refreshTasks() {
      var userId = getCurrentUserId();
      if (!userId) {
        alert("æœªæ‰¾åˆ°ç”¨æˆ·IDï¼Œè¯·é‡æ–°ç™»å½•åå†è¯•ã€‚");
        return;
      }

      try {
        var response = await fetch("/api/task/refresh", {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify({
            user_id: parseInt(userId, 10)
          })
        });

        if (!response.ok) {
          throw new Error("ç½‘ç»œé”™è¯¯ï¼ŒçŠ¶æ€ç ï¼š" + response.status);
        }

        var result = await response.json();
        if (result.success) {
          renderTasks(result.tasks  || []);
        } else {
          alert(result.message || "åˆ·æ–°ä»»åŠ¡å¤±è´¥");
        }
      } catch (err) {
        console.error(err);
        alert("åˆ·æ–°ä»»åŠ¡å¤±è´¥ï¼š" + err.message);
      }
    }

    // è°ƒç”¨ /api/task/add æ·»åŠ ä»»åŠ¡
    async function handleAddTask(event) {
      event.preventDefault();

      var userId = getCurrentUserId();
      if (!userId) {
        alert("æœªæ‰¾åˆ°ç”¨æˆ·IDï¼Œè¯·é‡æ–°ç™»å½•åå†è¯•ã€‚");
        return;
      }

      var timeInput = document.getElementById("taskTime");
      var placeInput = document.getElementById("taskPlace");
      var staffInput = document.getElementById("taskStaff");
      var urgencySelect = document.getElementById("taskUrgency");
      var somethingInput = document.getElementById("taskSomething");

      var payload = {
        user_id: parseInt(userId, 10),
        time: timeInput.value,
        place: placeInput.value,
        staff: staffInput.value,
        something: somethingInput.value,
        urgency: parseInt(urgencySelect.value || "1", 10)
      };

      if (!payload.time || !payload.something) {
        alert("æ—¥æœŸå’Œä»»åŠ¡å†…å®¹ä¸ºå¿…å¡«é¡¹ã€‚");
        return;
      }

      try {
        var response = await fetch("/api/task/add", {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify(payload)
        });

        if (!response.ok) {
          throw new Error("ç½‘ç»œé”™è¯¯ï¼ŒçŠ¶æ€ç ï¼š" + response.status);
        }

        var result = await response.json();
        if (result.success) {
          // æ¸…ç©ºè¡¨å•
          placeInput.value = "";
          staffInput.value = "";
          somethingInput.value = "";
          urgencySelect.value = "1";
          // é‡æ–°åˆ·æ–°åˆ—è¡¨
          await refreshTasks();
        } else {
          alert(result.message || "æ·»åŠ ä»»åŠ¡å¤±è´¥");
        }
      } catch (err) {
        console.error(err);
        alert("æ·»åŠ ä»»åŠ¡å¤±è´¥ï¼š" + err.message);
      }
    }

    // è°ƒç”¨ /api/task/delete åˆ é™¤ä»»åŠ¡
    async function deleteTaskById(id) {
      if (!id) return;
      if (!confirm("ç¡®è®¤åˆ é™¤è¿™æ¡ä»»åŠ¡å—ï¼Ÿ")) return;

      try {
        var response = await fetch("/api/task/delete", {
          method: "DELETE",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify({ id: id })
        });

        if (!response.ok) {
          throw new Error("ç½‘ç»œé”™è¯¯ï¼ŒçŠ¶æ€ç ï¼š" + response.status);
        }

        var result = await response.json();
        if (result.success) {
          await refreshTasks();
        } else {
          alert(result.message || "åˆ é™¤ä»»åŠ¡å¤±è´¥");
        }
      } catch (err) {
        console.error(err);
        alert("åˆ é™¤ä»»åŠ¡å¤±è´¥ï¼š" + err.message);
      }
    }

    // äº‹é¡¹çœ‹æ¿å†…äº‹ä»¶ç»‘å®šï¼ˆæŒ‰é’®ã€å¡ç‰‡åˆ é™¤ï¼‰
    function initTodoTaskEvents() {
      var refreshBtn = document.getElementById("btnRefreshTasks");
      if (refreshBtn) {
        refreshBtn.addEventListener("click", function () {
          refreshTasks();
        });
      }

      var taskForm = document.getElementById("taskForm");
      if (taskForm) {
        taskForm.addEventListener("submit", handleAddTask);
      }

      var taskBoard = document.getElementById("taskBoard");
      if (taskBoard) {
        taskBoard.addEventListener("click", function (event) {
          var target = event.target;
          if (target.classList.contains("task-delete-btn")) {
            var id = target.getAttribute("data-id");
            deleteTaskById(id);
          }
        });
      }
    }

// ========== æ™ºèƒ½ä»»åŠ¡åˆ†è§£åŠŸèƒ½ ==========
async function generateTasks() {
    const taskInput = document.getElementById('taskInput');
    const complexitySelect = document.getElementById('taskComplexity');
    const deadlineInput = document.getElementById('taskDeadline');
    
    const taskDescription = taskInput.value.trim();
    if (!taskDescription) {
        alert('è¯·è¾“å…¥éœ€è¦åˆ†è§£çš„ä»»åŠ¡æè¿°');
        return;
    }

    // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
    document.getElementById('loadingSection').style.display = 'block';
    document.getElementById('resultSection').style.display = 'none';

    try {
        const response = await fetch('/api/ai/generate-tasks', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                task: taskDescription,
                complexity: complexitySelect.value,
                deadline: parseInt(deadlineInput.value)
            })
        });

        if (!response.ok) {
            throw new Error('ç½‘ç»œè¯·æ±‚å¤±è´¥');
        }

        const result = await response.json();
        
        // éšè—åŠ è½½çŠ¶æ€
        document.getElementById('loadingSection').style.display = 'none';
        
        if (result.success) {
            // æ˜¾ç¤ºç»“æœ
            displayGeneratedTasks(result.tasks || []);
            document.getElementById('resultSection').style.display = 'block';
        } else {
            alert(result.message || 'ä»»åŠ¡åˆ†è§£å¤±è´¥');
        }
    } catch (error) {
        console.error('ä»»åŠ¡åˆ†è§£é”™è¯¯:', error);
        document.getElementById('loadingSection').style.display = 'none';
        alert('ä»»åŠ¡åˆ†è§£å¤±è´¥: ' + error.message);
    }
}

function displayGeneratedTasks(tasks) {
    const container = document.getElementById('generatedTasks');
    container.innerHTML = '';

    tasks.forEach((task, index) => {
        const taskElement = document.createElement('div');
        taskElement.className = 'generated-task-item';
        taskElement.innerHTML = `
            <h4>å­ä»»åŠ¡ ${index + 1}: ${task.title || 'æœªå‘½åä»»åŠ¡'}</h4>
            <p>${task.description || 'æš‚æ— æè¿°'}</p>
            ${task.estimated_time ? `<p><small>é¢„è®¡è€—æ—¶: ${task.estimated_time}</small></p>` : ''}
        `;
        container.appendChild(taskElement);
    });
}

// åˆå§‹åŒ–ä»»åŠ¡åˆ†è§£æ¨¡å—äº‹ä»¶
function initTaskGeneratorEvents() {
    const generateBtn = document.getElementById('btnGenerateTasks');
    const saveBtn = document.getElementById('btnSaveTasks');
    const regenerateBtn = document.getElementById('btnRegenerate');

    if (generateBtn) {
        generateBtn.addEventListener('click', generateTasks);
    }
    
    if (saveBtn) {
        saveBtn.addEventListener('click', function() {
            alert('ä¿å­˜åŠŸèƒ½å¾…å®ç° - è¿™é‡Œå¯ä»¥è°ƒç”¨ä»»åŠ¡æ·»åŠ æ¥å£');
        });
    }
    
    if (regenerateBtn) {
        regenerateBtn.addEventListener('click', generateTasks);
    }
}

// åœ¨DOMåŠ è½½å®Œæˆååˆå§‹åŒ–
window.addEventListener('DOMContentLoaded', function() {
    // ... ç°æœ‰ä»£ç  ...
    
    // æ–°å¢ï¼šåˆå§‹åŒ–ä»»åŠ¡åˆ†è§£äº‹ä»¶
    initTaskGeneratorEvents();
});

    // ========== å·¦ä¾§å¯¼èˆªï¼šé¡µé¢åˆ‡æ¢é€»è¾‘ ==========
    document.querySelectorAll(".nav-links li").forEach(function (item) {
      item.addEventListener("click", function () {
        var pageId = this.getAttribute("data-page");

        // ç§»é™¤æ‰€æœ‰ active
        document
          .querySelectorAll(".nav-links li")
          .forEach(function (li) {
            li.classList.remove("active");
          });
        document
          .querySelectorAll(".page")
          .forEach(function (p) {
            p.classList.remove("active");
          });

        // æ¿€æ´»å½“å‰é¡¹
        this.classList.add("active");
        var pageElement = document.getElementById("page-" + pageId);
        if (pageElement) {
          pageElement.classList.add("active");
        }

        // å¦‚æœåˆ‡æ¢åˆ°äº‹é¡¹çœ‹æ¿ï¼Œè‡ªåŠ¨åˆ·æ–°ä¸€æ¬¡
        if (pageId === "todotask") {
          refreshTasks();
        }
      });
    });

    // é€€å‡ºç™»å½•
    function logout() {
      localStorage.removeItem("userId");
      localStorage.removeItem("teamName");
      window.location.href = "/"; // è·³å›ç™»å½•é¡µ
    }

    // é¡µé¢åŠ è½½æ—¶æ¢å¤ç”¨æˆ·ä¿¡æ¯ï¼ˆç”¨äºâ€œä¸ªäººä¸­å¿ƒâ€ï¼‰
    window.addEventListener("DOMContentLoaded", function () {
      var userId = localStorage.getItem("userId");
      var teamName = localStorage.getItem("teamName");

      // å¦‚æœä½ é¡µé¢é‡ŒçœŸçš„æœ‰å¯¹åº”å…ƒç´ ï¼Œå¯ä»¥è§£å¼€ä¸‹é¢çš„æ³¨é‡Šæ¥æ˜¾ç¤º
      // var userIdSpan = document.getElementById("displayUserId");
      // var teamNameSpan = document.getElementById("displayTeamName");

      if (userId && teamName) {
        // if (userIdSpan) userIdSpan.textContent = userId;
        // if (teamNameSpan) teamNameSpan.textContent = teamName;
      } else {
        // æœªç™»å½•åˆ™è·³è½¬å›é¦–é¡µ
        window.location.href = "/";
      }

      // åˆå§‹åŒ–äº‹é¡¹çœ‹æ¿çš„äº‹ä»¶ï¼ˆæŒ‰é’®ã€è¡¨å•ã€å¡ç‰‡åˆ é™¤ï¼‰
      initTodoTaskEvents();
    });
  </script>


</body>
</html>