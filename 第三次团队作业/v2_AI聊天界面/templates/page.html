<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ç³»ç»Ÿä¸»ç•Œé¢</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='team.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='todotask.css') }}">
  <!-- å¼•å…¥AIèŠå¤©æ¨¡å—çš„CSSæ ·å¼ -->
  <link rel="stylesheet" href="{{ url_for('static', filename='ai-chat.css') }}">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: "Segoe UI", "Microsoft YaHei", sans-serif;
    }

    body {
      display: flex;
      min-height: 100vh;
      background-color: #f8f9fa;
    }

    /* ========== å·¦ä¾§è¾¹æ  ========== */
    .sidebar {
      width: 240px;
      background: #2c3e50;
      color: white;
      display: flex;
      flex-direction: column;
      box-shadow: 2px 0 10px rgba(0,0,0,0.1);
      position: fixed;
      height: 100vh;
      overflow-y: auto;
    }

    .logo-container {
      padding: 20px;
      border-bottom: 1px solid #34495e;
    }

    .logo {
      font-size: 24px;
      font-weight: bold;
      color: #3498db;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .logo img {
      width: 36px;
      height: 36px;
      background: #3498db;
      border-radius: 6px;
    }

    .nav-links {
      padding: 20px 0;
      list-style: none;
    }

    .nav-links li {
      padding: 12px 24px;
      cursor: pointer;
      transition: background 0.2s, color 0.2s;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .nav-links li:hover,
    .nav-links li.active {
      background: #34495e;
      color: #3498db;
    }

    .nav-links li i {
      font-size: 18px;
      width: 24px;
      text-align: center;
    }

    /* ========== ä¸»å†…å®¹åŒº ========== */
    .main-content {
      flex: 1;
      margin-left: 240px;
      padding: 30px;
      background: #ffffff;
    }

    .page {
      display: none;
      animation: fadeIn 0.4s ease-in-out;
    }

    .page.active {
      display: block;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    h2 {
      margin-bottom: 20px;
      color: #2c3e50;
    }

    .page-content {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 8px;
      min-height: 500px;
    }

    /* å“åº”å¼ï¼šå°å±éšè—ä¾§è¾¹æ ï¼ˆå¯é€‰ï¼‰ */
    @media (max-width: 768px) {
      .sidebar {
        width: 70px;
      }
      .sidebar .logo span,
      .sidebar .nav-links li span {
        display: none;
      }
      .main-content {
        margin-left: 70px;
      }
    }
  </style>
</head>
<body>

  <!-- å·¦ä¾§å¯¼èˆªæ  -->
  <div class="sidebar">
    <div class="logo-container">
      <div class="logo">
        <span>ä½ å¥½ï¼å°åŠåŒå­¦</span>
      </div>
    </div>
    <ul class="nav-links" id="navLinks">

      <li data-page="dashboard" class="active">
        <span>ğŸ’¡</span>
        <span>AIåŠ©æ‰‹</span>
      </li>

      <li data-page="data">
        <span>ğŸ§‘â€ğŸ’¼</span>
        <span>æˆå‘˜æ•°æ®</span>
      </li>

      <li data-page="meeting">
        <span>ğŸ“„</span>
        <span>ä¼šè®®åŠ©æ‰‹</span>
      </li>

      <li data-page="task_generater">
        <span>ğŸ§©</span>
        <span>æ™ºèƒ½ä»»åŠ¡åˆ†è§£</span>
      </li>

      <li data-page="todotask">
        <span>ğŸ“</span>
        <span>äº‹é¡¹çœ‹æ¿</span>
      </li>

    </ul>
  </div>

  <!-- å³ä¾§å†…å®¹åŒº -->
  <div class="main-content">
    <!-- AIèŠå¤©æ¨¡å— - æ·»åŠ å®Œæ•´çš„å¯¹è¯ç•Œé¢ -->
    <div class="page active" id="page-dashboard">
      <h2>ğŸ’¡ æ¥å’Œå¤§æ¨¡å‹èŠå¤©</h2>
      <div class="page-content">
        <div class="ai-chat-container">
          <div class="ai-chat-header">
            <h3>å°åŠåŒå­¦</h3>
            <button type="button" id="clearChatBtn" class="ai-chat-clear-btn">æ¸…ç©ºè®°å½•</button>
          </div>
          <div id="chatMessages" class="ai-chat-messages"></div>
          <form id="chatForm" class="ai-chat-input-area">
            <input
              type="text"
              id="chatInput"
              class="ai-chat-input"
              placeholder="è¾“å…¥æ‚¨çš„é—®é¢˜..."
              autocomplete="off"
              required
            />
            <button type="submit" class="ai-chat-send-btn">å‘é€</button>
          </form>
        </div>
      </div>
    </div>

    <!-- å›¢é˜Ÿæˆå‘˜ -->
    <div class="page" id="page-data">
      <!-- å›¢é˜Ÿç®¡ç†æ¨¡å— -->
      <!-- å›¢é˜Ÿç®¡ç†æ¨¡å— -->
        <div class="team-management">
          <h2>ğŸ§‘ ğŸ’¼ æˆå‘˜æ•°æ®</h2>
          <p>å›¢é˜Ÿæˆå‘˜ç®¡ç†</p>

          <div class="member-controls">
            <button id="btnRefreshMembers" class="btn-primary">åˆ·æ–°æˆå‘˜</button>
          </div>

          <div id="memberBoard" class="member-board">
            <!-- æˆå‘˜å¡ç‰‡å°†åœ¨è¿™é‡ŒåŠ¨æ€æ¸²æŸ“ -->
          </div>

          <div class="add-member-form">
            <h3>æ·»åŠ æ–°æˆå‘˜</h3>
            <form id="memberForm">
              <div class="form-group">
                <label for="memberName">å§“å:</label>
                <input type="text" id="memberName" required placeholder="è¯·è¾“å…¥æˆå‘˜å§“å">
              </div>
              <div class="form-group">
                <label for="memberTechStack">æŠ€æœ¯æ ˆ (ç”¨é€—å·åˆ†éš”):</label>
                <input type="text" id="memberTechStack" placeholder="ä¾‹å¦‚: JavaScript, Python, SQL">
              </div>
              <button type="submit" class="btn-primary">æ·»åŠ æˆå‘˜</button>
            </form>
          </div>
        </div>
    </div>

    <!-- ä¼šè®®åŠ©æ‰‹ -->
    <div class="page" id="page-meeting">
      <h2>ğŸ“„ ä¼šè®®è¯­è¨€è½¬æ–‡å­—ã€è¯­è¨€ä¸€é”®ç”Ÿæˆæ‘˜è¦</h2>
      <div class="page-content">
        <p>è‡ªåŠ¨ç”Ÿæˆå‘¨æŠ¥ã€æœˆæŠ¥æˆ–è‡ªå®šä¹‰æŠ¥å‘Šã€‚</p>
        <select style="margin-top: 10px; padding: 5px;">
          <option>é€‰æ‹©æŠ¥å‘Šç±»å‹</option>
          <option>å‘¨æŠ¥</option>
          <option>æœˆæŠ¥</option>
        </select>
      </div>
    </div>

    <!-- æ™ºèƒ½ä»»åŠ¡åˆ†è§£ -->
    <div class="page" id="page-task_generater">
      <h2>ğŸ§© æ™ºèƒ½ä»»åŠ¡åˆ†è§£</h2>
      <div class="page-content">
        <p>é…ç½®ç³»ç»Ÿå‚æ•°ã€æƒé™ç®¡ç†ã€é€šçŸ¥è®¾ç½®ç­‰ã€‚</p>
        <label><input type="checkbox"> å¯ç”¨é‚®ä»¶é€šçŸ¥</label>
      </div>
    </div>

    <!-- äº‹é¡¹çœ‹æ¿ -->
    <div class="page" id="page-todotask">
      <h2>ğŸ“ äº‹é¡¹çœ‹æ¿</h2>
      <div class="page-content">
        <div class="todo-wrapper">
          <!-- é¡¶éƒ¨ï¼šæ ‡é¢˜ + åˆ·æ–°æŒ‰é’® -->
          <div class="todo-header">
            <div>
              <h3>å›¢é˜Ÿå¾…åŠäº‹é¡¹</h3>
              <p class="todo-subtitle">æ ¹æ®å½“å‰ç™»å½•ç”¨æˆ·åŠ è½½ä»»åŠ¡</p>
            </div>
            <div class="todo-actions">
              <button type="button" id="btnRefreshTasks" class="btn-secondary">
                åˆ·æ–°ä»»åŠ¡
              </button>
            </div>
          </div>

          <!-- æ·»åŠ ä»»åŠ¡è¡¨å• -->
          <form id="taskForm" class="task-form">
            <div class="task-form-row">
              <div class="task-form-field">
                <label for="taskTime">æ—¥æœŸ</label>
                <input type="date" id="taskTime" name="time" required />
              </div>
              <div class="task-form-field">
                <label for="taskPlace">åœ°ç‚¹</label>
                <input
                  type="text"
                  id="taskPlace"
                  name="place"
                  placeholder="ä¾‹å¦‚ï¼šå®éªŒå®¤A"
                />
              </div>
            </div>

            <div class="task-form-row">
              <div class="task-form-field">
                <label for="taskStaff">è´Ÿè´£äºº</label>
                <input
                  type="text"
                  id="taskStaff"
                  name="staff"
                  placeholder="ä¾‹å¦‚ï¼šå¼ ä¸‰"
                />
              </div>
              <div class="task-form-field">
                <label for="taskUrgency">ç´§æ€¥ç¨‹åº¦</label>
                <select id="taskUrgency" name="urgency">
                  <option value="1">ä¸€èˆ¬</option>
                  <option value="2">é‡è¦</option>
                  <option value="3">ç´§æ€¥</option>
                </select>
              </div>
            </div>

            <div class="task-form-row">
              <div class="task-form-field full">
                <label for="taskSomething">ä»»åŠ¡å†…å®¹</label>
                <textarea
                  id="taskSomething"
                  name="something"
                  rows="2"
                  placeholder="éœ€è¦å®Œæˆçš„äº‹é¡¹..."
                  required
                ></textarea>
              </div>
            </div>

            <div class="task-form-actions">
              <button type="submit" class="btn-primary">
                æ·»åŠ ä»»åŠ¡
              </button>
            </div>
          </form>

          <!-- ä»»åŠ¡å¡ç‰‡å®¹å™¨ -->
          <div id="taskBoard" class="task-board">
            <p class="task-empty">
              ç›®å‰è¿˜æ²¡æœ‰ä»»åŠ¡ï¼Œç‚¹å‡»ä¸Šæ–¹â€œåˆ·æ–°ä»»åŠ¡â€ä»åç«¯åŠ è½½æ•°æ®ï¼Œæˆ–è€…å…ˆæ·»åŠ ä¸€æ¡ä»»åŠ¡ã€‚
            </p>
          </div>
        </div>
      </div>
    </div>

  </div>

    <!-- å¼•å…¥axioså’ŒAIèŠå¤©æ¨¡å—çš„JS -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="{{ url_for('static', filename='ai-chat.js') }}"></script>
    <script>
      // ç¡®ä¿DOMåŠ è½½å®Œæˆååˆå§‹åŒ–
      document.addEventListener('DOMContentLoaded', function() {
        if (window.AIChat) {
          window.AIChat.init();
        } else {
          console.error('AIChat module not loaded properly');
        }
      });
    </script>
    <script>
    // è·å–å½“å‰ç™»å½•ç”¨æˆ·çš„ userIdï¼ˆç™»å½•æ—¶å†™å…¥ localStorageï¼‰
    function getCurrentUserId() {
      return localStorage.getItem("userId");
    }

    // æ¸²æŸ“ä»»åŠ¡åˆ—è¡¨ä¸ºå¡ç‰‡
    function renderTasks(tasks) {
      var board = document.getElementById("taskBoard");
      if (!board) return;

      board.innerHTML = "";

      if (!tasks || tasks.length === 0) {
        var empty = document.createElement("p");
        empty.className = "task-empty";
        empty.textContent = "æ²¡æœ‰ä»»åŠ¡ï¼Œè¯•è¯•æ·»åŠ ä¸€æ¡æˆ–ç‚¹å‡»â€œåˆ·æ–°ä»»åŠ¡â€ã€‚";
        board.appendChild(empty);
        return;
      }

      tasks.forEach(function (task) {
        var card = document.createElement("div");
        card.className = "task-card";

        var title = document.createElement("div");
        title.className = "task-title";
        title.textContent = task.something || "æœªå¡«å†™ä»»åŠ¡å†…å®¹";

        var meta = document.createElement("div");
        meta.className = "task-meta";

        var timeSpan = document.createElement("span");
        timeSpan.textContent = "æ—¥æœŸï¼š" + (task.time || "-");

        var placeSpan = document.createElement("span");
        placeSpan.textContent = "åœ°ç‚¹ï¼š" + (task.place || "-");

        var staffSpan = document.createElement("span");
        staffSpan.textContent = "è´Ÿè´£äººï¼š" + (task.staff || "-");

        meta.appendChild(timeSpan);
        meta.appendChild(placeSpan);
        meta.appendChild(staffSpan);

        var content = document.createElement("div");
        content.className = "task-content";
        content.textContent = task.something || "";

        var footer = document.createElement("div");
        footer.className = "task-footer";

        var urgencySpan = document.createElement("span");
        urgencySpan.className = "task-urgency";
        urgencySpan.textContent = "ç´§æ€¥ç¨‹åº¦ï¼š" + (task.urgency || 1);

        var deleteBtn = document.createElement("button");
        deleteBtn.type = "button";
        deleteBtn.className = "task-delete-btn";
        deleteBtn.textContent = "åˆ é™¤";
        deleteBtn.setAttribute("data-id", task.id);

        footer.appendChild(urgencySpan);
        footer.appendChild(deleteBtn);

        card.appendChild(title);
        card.appendChild(meta);
        // card.appendChild(content);
        card.appendChild(footer);

        board.appendChild(card);
      });
    }

    // è°ƒç”¨ /api/task/refresh è·å–ä»»åŠ¡åˆ—è¡¨
    async function refreshTasks() {
      var userId = getCurrentUserId();
      if (!userId) {
        alert("æœªæ‰¾åˆ°ç”¨æˆ·IDï¼Œè¯·é‡æ–°ç™»å½•åå†è¯•ã€‚");
        return;
      }

      try {
        var response = await fetch("/api/task/refresh", {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify({
            user_id: parseInt(userId, 10)
          })
        });

        if (!response.ok) {
          throw new Error("ç½‘ç»œé”™è¯¯ï¼ŒçŠ¶æ€ç ï¼š" + response.status);
        }

        var result = await response.json();
        if (result.success) {
          renderTasks(result.tasks  || []);
        } else {
          alert(result.message || "åˆ·æ–°ä»»åŠ¡å¤±è´¥");
        }
      } catch (err) {
        console.error(err);
        alert("åˆ·æ–°ä»»åŠ¡å¤±è´¥ï¼š" + err.message);
      }
    }

    // è°ƒç”¨ /api/task/add æ·»åŠ ä»»åŠ¡
    async function handleAddTask(event) {
      event.preventDefault();

      var userId = getCurrentUserId();
      if (!userId) {
        alert("æœªæ‰¾åˆ°ç”¨æˆ·IDï¼Œè¯·é‡æ–°ç™»å½•åå†è¯•ã€‚");
        return;
      }

      var timeInput = document.getElementById("taskTime");
      var placeInput = document.getElementById("taskPlace");
      var staffInput = document.getElementById("taskStaff");
      var urgencySelect = document.getElementById("taskUrgency");
      var somethingInput = document.getElementById("taskSomething");

      var payload = {
        user_id: parseInt(userId, 10),
        time: timeInput.value,
        place: placeInput.value,
        staff: staffInput.value,
        something: somethingInput.value,
        urgency: parseInt(urgencySelect.value || "1", 10)
      };

      if (!payload.time || !payload.something) {
        alert("æ—¥æœŸå’Œä»»åŠ¡å†…å®¹ä¸ºå¿…å¡«é¡¹ã€‚");
        return;
      }

      try {
        var response = await fetch("/api/task/add", {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify(payload)
        });

        if (!response.ok) {
          throw new Error("ç½‘ç»œé”™è¯¯ï¼ŒçŠ¶æ€ç ï¼š" + response.status);
        }

        var result = await response.json();
        if (result.success) {
          // æ¸…ç©ºè¡¨å•
          placeInput.value = "";
          staffInput.value = "";
          somethingInput.value = "";
          urgencySelect.value = "1";
          // é‡æ–°åˆ·æ–°åˆ—è¡¨
          await refreshTasks();
        } else {
          alert(result.message || "æ·»åŠ ä»»åŠ¡å¤±è´¥");
        }
      } catch (err) {
        console.error(err);
        alert("æ·»åŠ ä»»åŠ¡å¤±è´¥ï¼š" + err.message);
      }
    }

    // è°ƒç”¨ /api/task/delete åˆ é™¤ä»»åŠ¡
    async function deleteTaskById(id) {
      if (!id) return;
      if (!confirm("ç¡®è®¤åˆ é™¤è¿™æ¡ä»»åŠ¡å—ï¼Ÿ")) return;

      try {
        var response = await fetch("/api/task/delete", {
          method: "DELETE",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify({ id: id })
        });

        if (!response.ok) {
          throw new Error("ç½‘ç»œé”™è¯¯ï¼ŒçŠ¶æ€ç ï¼š" + response.status);
        }

        var result = await response.json();
        if (result.success) {
          await refreshTasks();
        } else {
          alert(result.message || "åˆ é™¤ä»»åŠ¡å¤±è´¥");
        }
      } catch (err) {
        console.error(err);
        alert("åˆ é™¤ä»»åŠ¡å¤±è´¥ï¼š" + err.message);
      }
    }

    // äº‹é¡¹çœ‹æ¿å†…äº‹ä»¶ç»‘å®šï¼ˆæŒ‰é’®ã€å¡ç‰‡åˆ é™¤ï¼‰
    function initTodoTaskEvents() {
      var refreshBtn = document.getElementById("btnRefreshTasks");
      if (refreshBtn) {
        refreshBtn.addEventListener("click", function () {
          refreshTasks();
        });
      }

      var taskForm = document.getElementById("taskForm");
      if (taskForm) {
        taskForm.addEventListener("submit", handleAddTask);
      }

      var taskBoard = document.getElementById("taskBoard");
      if (taskBoard) {
        taskBoard.addEventListener("click", function (event) {
          var target = event.target;
          if (target.classList.contains("task-delete-btn")) {
            var id = target.getAttribute("data-id");
            deleteTaskById(id);
          }
        });
      }
    }

    // ========== å·¦ä¾§å¯¼èˆªï¼šé¡µé¢åˆ‡æ¢é€»è¾‘ ==========
    document.querySelectorAll(".nav-links li").forEach(function (item) {
      item.addEventListener("click", function () {
        var pageId = this.getAttribute("data-page");

        // ç§»é™¤æ‰€æœ‰ active
        document
          .querySelectorAll(".nav-links li")
          .forEach(function (li) {
            li.classList.remove("active");
          });
        document
          .querySelectorAll(".page")
          .forEach(function (p) {
            p.classList.remove("active");
          });

        // æ¿€æ´»å½“å‰é¡¹
        this.classList.add("active");
        var pageElement = document.getElementById("page-" + pageId);
        if (pageElement) {
          pageElement.classList.add("active");
        }

        // å¦‚æœåˆ‡æ¢åˆ°äº‹é¡¹çœ‹æ¿ï¼Œè‡ªåŠ¨åˆ·æ–°ä¸€æ¬¡
        if (pageId === "todotask") {
          refreshTasks();
        }
      });
    });

    // é€€å‡ºç™»å½•
    function logout() {
      localStorage.removeItem("userId");
      localStorage.removeItem("teamName");
      window.location.href = "/"; // è·³å›ç™»å½•é¡µ
    }

    // é¡µé¢åŠ è½½æ—¶æ¢å¤ç”¨æˆ·ä¿¡æ¯ï¼ˆç”¨äºâ€œä¸ªäººä¸­å¿ƒâ€ï¼‰
    window.addEventListener("DOMContentLoaded", function () {
      var userId = localStorage.getItem("userId");
      var teamName = localStorage.getItem("teamName");

      // å¦‚æœä½ é¡µé¢é‡ŒçœŸçš„æœ‰å¯¹åº”å…ƒç´ ï¼Œå¯ä»¥è§£å¼€ä¸‹é¢çš„æ³¨é‡Šæ¥æ˜¾ç¤º
      // var userIdSpan = document.getElementById("displayUserId");
      // var teamNameSpan = document.getElementById("displayTeamName");

      if (userId && teamName) {
        // if (userIdSpan) userIdSpan.textContent = userId;
        // if (teamNameSpan) teamNameSpan.textContent = teamName;
      } else {
        // æœªç™»å½•åˆ™è·³è½¬å›é¦–é¡µ
        window.location.href = "/";
      }

      // åˆå§‹åŒ–äº‹é¡¹çœ‹æ¿çš„äº‹ä»¶ï¼ˆæŒ‰é’®ã€è¡¨å•ã€å¡ç‰‡åˆ é™¤ï¼‰
      initTodoTaskEvents();
    });

    // ========== å›¢é˜Ÿç®¡ç†æ¨¡å— ==========
    // æ¸²æŸ“æˆå‘˜åˆ—è¡¨ä¸ºå¡ç‰‡
    function renderMembers(members) {
        var container = document.getElementById("memberBoard");
        if (!container) return;

        container.innerHTML = "";

        if (!members || members.length === 0) {
            var empty = document.createElement("p");
            empty.className = "member-empty";
            empty.textContent = "æ²¡æœ‰å›¢é˜Ÿæˆå‘˜ï¼Œç‚¹å‡»æ·»åŠ æŒ‰é’®æ·»åŠ æ–°æˆå‘˜ã€‚";
            container.appendChild(empty);
            return;
        }

        members.forEach(function(member) {
            var card = document.createElement("div");
            card.className = "member-card";
            card.setAttribute("data-id", member.id);

            var header = document.createElement("div");
            header.className = "member-header";

            var name = document.createElement("h3");
            name.textContent = member.name || "æœªå‘½å";
            name.className = "member-name";

            var techStack = document.createElement("div");
            techStack.className = "member-tech";
            var techs = member.tech_stack && Array.isArray(member.tech_stack) ?
                member.tech_stack.join(", ") : "æ— æŠ€æœ¯æ ˆ";
            techStack.textContent = "æŠ€æœ¯æ ˆ: " + techs;

            header.appendChild(name);
            header.appendChild(techStack);

            var scores = document.createElement("div");
            scores.className = "member-scores";

            var quality = document.createElement("span");
            quality.textContent = "è´¨é‡: " + (member.quality_score || "0.00");

            var workload = document.createElement("span");
            workload.textContent = "å·¥ä½œé‡: " + (member.workload_score || "0.00");

            var collaboration = document.createElement("span");
            collaboration.textContent = "åä½œ: " + (member.collaboration_score || "0.00");

            scores.appendChild(quality);
            scores.appendChild(workload);
            scores.appendChild(collaboration);

            var footer = document.createElement("div");
            footer.className = "member-footer";

            var deleteBtn = document.createElement("button");
            deleteBtn.type = "button";
            deleteBtn.className = "member-delete-btn";
            deleteBtn.textContent = "åˆ é™¤";
            deleteBtn.setAttribute("data-id", member.id);

            footer.appendChild(deleteBtn);
            card.appendChild(header);
            card.appendChild(scores);
            card.appendChild(footer);

            container.appendChild(card);
        });
    }

    // è°ƒç”¨ /api/member/list è·å–æˆå‘˜åˆ—è¡¨
    async function refreshMembers() {
        var userId = getCurrentUserId();
        if (!userId) {
            alert("æœªæ‰¾åˆ°ç”¨æˆ·IDï¼Œè¯·é‡æ–°ç™»å½•åå†è¯•ã€‚");
            return;
        }

        try {
            var response = await fetch("/api/member/list", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    user_id: parseInt(userId, 10)
                })
            });

            if (!response.ok) {
                throw new Error("ç½‘ç»œé”™è¯¯ï¼ŒçŠ¶æ€ç ï¼š" + response.status);
            }

            var result = await response.json();

            // ä¿®æ­£1ï¼šæ ¹æ®åç«¯çš„å“åº”ç»“æ„ï¼Œç›´æ¥è®¿é—® result.members è€Œä¸æ˜¯ result.data
            if (result.success) {
              // ä¿®æ­£2ï¼šåŒæ—¶å…¼å®¹ä¸¤ç§å¯èƒ½çš„ç»“æ„ï¼Œå¢åŠ å¥å£®æ€§
              const members = result.members || (result.data && result.data.members) || [];

              // æ–°å¢ï¼šç¡®ä¿æ¯ä¸ªæˆå‘˜å¯¹è±¡éƒ½åŒ…å«å››ä¸ªè¯„åˆ†å±æ€§ï¼ˆå¦‚æœåç«¯è¿”å›äº†è¿™äº›å±æ€§ï¼‰
              members.forEach(member => {
                  // ä¿ç•™åŸæœ‰å±æ€§ï¼Œåªæ·»åŠ ç¼ºå¤±çš„è¯„åˆ†å±æ€§
                  member.quality_score = member.quality_score !== undefined ? member.quality_score : 0.0;
                  member.workload_score = member.workload_score !== undefined ? member.workload_score : 0.0;
                  member.collaboration_score = member.collaboration_score !== undefined ? member.collaboration_score : 0.0;
                  member.completion_score = member.completion_score !== undefined ? member.completion_score : 0.0;
              });

              renderMembers(members);

              // ä¿®æ­£3ï¼šå¦‚æœæˆå‘˜åˆ—è¡¨ä¸ºç©ºï¼Œæä¾›å‹å¥½æç¤º
              if (members.length === 0) {
                  const memberBoard = document.getElementById('memberBoard');
                  if (memberBoard) {
                      memberBoard.innerHTML = `
                          <div class="member-empty">
                              <div>ğŸ‘¥</div>
                              <p>æš‚æ— å›¢é˜Ÿæˆå‘˜</p>
                              <p>ç‚¹å‡»ä¸‹æ–¹"æ·»åŠ æ–°æˆå‘˜"å¼€å§‹åˆ›å»ºæ‚¨çš„å›¢é˜Ÿ</p>
                          </div>
                      `;
                  }
              }
          } else {
                // ä¿®æ­£4ï¼šæä¾›æ›´è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯
                console.error("åç«¯è¿”å›é”™è¯¯:", result);
                alert(result.message || "åˆ·æ–°æˆå‘˜å¤±è´¥");
            }
        } catch (err) {
            console.error("åˆ·æ–°æˆå‘˜åˆ—è¡¨æ—¶å‘ç”Ÿé”™è¯¯:", err);

            // ä¿®æ­£5ï¼šå°è¯•è§£æå¯èƒ½çš„åç«¯é”™è¯¯
            if (err.message.includes('JSON')) {
                alert("æ•°æ®è§£æé”™è¯¯: æœåŠ¡å™¨è¿”å›äº†æ— æ•ˆçš„JSONæ ¼å¼ã€‚è¿™é€šå¸¸è¡¨ç¤ºåç«¯ä»£ç å­˜åœ¨é”™è¯¯ã€‚");
            } else if (err.message.includes('404')) {
                alert("APIç«¯ç‚¹ä¸å­˜åœ¨: è¯·æ£€æŸ¥åç«¯è·¯ç”±é…ç½®æ˜¯å¦æ­£ç¡®");
            } else {
                alert("åˆ·æ–°æˆå‘˜å¤±è´¥: " + (err.message || "æœªçŸ¥é”™è¯¯"));
            }
        }
    }

    // è°ƒç”¨ /api/member/add æ·»åŠ æˆå‘˜
    async function handleAddMember(event) {
        event.preventDefault();

        var userId = getCurrentUserId();
        if (!userId) {
            alert("æœªæ‰¾åˆ°ç”¨æˆ·IDï¼Œè¯·é‡æ–°ç™»å½•åå†è¯•ã€‚");
            return;
        }

        var nameInput = document.getElementById("memberName");
        var techStackInput = document.getElementById("memberTechStack");

        var name = nameInput.value.trim();
        var techStack = techStackInput.value.trim();

        if (!name) {
            alert("æˆå‘˜å§“åä¸ºå¿…å¡«é¡¹ã€‚");
            return;
        }

        // å°†æŠ€æœ¯æ ˆè½¬æ¢ä¸ºæ•°ç»„
        var techStackArray = [];
        if (techStack) {
            techStackArray = techStack.split(",").map(function(item) {
                return item.trim();
            }).filter(function(item) {
                return item !== "";
            });
        }

        var payload = {
            user_id: parseInt(userId, 10),
            name: name,
            tech_stack: techStackArray
        };

        try {
            var response = await fetch("/api/member/add", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify(payload)
            });

            if (!response.ok) {
                throw new Error("ç½‘ç»œé”™è¯¯ï¼ŒçŠ¶æ€ç ï¼š" + response.status);
            }

            var result = await response.json();
            if (result.success) {
                // æ¸…ç©ºè¡¨å•
                nameInput.value = "";
                techStackInput.value = "";

                // é‡æ–°åˆ·æ–°åˆ—è¡¨
                await refreshMembers();
            } else {
                alert(result.message || "æ·»åŠ æˆå‘˜å¤±è´¥");
            }
        } catch (err) {
            console.error(err);
            alert("æ·»åŠ æˆå‘˜å¤±è´¥ï¼š" + err.message);
        }
    }

    // è°ƒç”¨ /api/member/update æ›´æ–°æˆå‘˜
    async function updateMember(memberId, updatedData) {
        try {
            // è·å–å½“å‰ç”¨æˆ·ID
            var userId = getCurrentUserId();
            if (!userId) {
                alert("æœªæ‰¾åˆ°ç”¨æˆ·IDï¼Œè¯·é‡æ–°ç™»å½•åå†è¯•ã€‚");
                return false;
            }

            // ç¡®ä¿æŠ€æœ¯æ ˆæ˜¯æ•°ç»„æ ¼å¼
            if (updatedData.tech_stack && typeof updatedData.tech_stack === 'string') {
                updatedData.tech_stack = updatedData.tech_stack.split(',').map(item => item.trim()).filter(item => item);
            }

            // æ–°å¢ï¼šç¡®ä¿å››ä¸ªè¯„åˆ†å±æ€§è¢«åŒ…å«åœ¨æ›´æ–°æ•°æ®ä¸­
            // å¦‚æœè°ƒç”¨è€…æ²¡æœ‰æä¾›è¿™äº›å±æ€§ï¼Œæˆ‘ä»¬ä¿ç•™å®ƒä»¬çš„å½“å‰å€¼ï¼ˆé¿å…é‡ç½®ä¸º0ï¼‰
            // æ³¨æ„ï¼šåœ¨å®é™…åº”ç”¨ä¸­ï¼Œåº”è¯¥å…ˆè·å–å½“å‰æˆå‘˜æ•°æ®ï¼Œè¿™é‡Œæä¾›é»˜è®¤å€¼ä½œä¸ºä¿æŠ¤
            const defaultScores = {
                quality_score: updatedData.quality_score !== undefined ? updatedData.quality_score : 0.0,
                workload_score: updatedData.workload_score !== undefined ? updatedData.workload_score : 0.0,
                collaboration_score: updatedData.collaboration_score !== undefined ? updatedData.collaboration_score : 0.0,
                completion_score: updatedData.completion_score !== undefined ? updatedData.completion_score : 0.0
            };

            var response = await fetch("/api/member/update", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    id: memberId,
                    user_id: parseInt(userId, 10), // æ·»åŠ user_id
                    ...updatedData,
                    // ç¡®ä¿å››ä¸ªè¯„åˆ†å±æ€§è¢«åŒ…å«åœ¨è¯·æ±‚ä¸­
                    ...defaultScores
                })
            });

            // éªŒè¯å“åº”æ˜¯å¦ä¸ºJSON
            const contentType = response.headers.get("content-type");
            if (contentType && !contentType.includes("application/json")) {
                throw new Error("æœåŠ¡å™¨è¿”å›äº†æ— æ•ˆçš„å“åº”æ ¼å¼");
            }

            if (!response.ok) {
                const errorData = await response.json().catch(() => ({}));
                throw new Error(`è¯·æ±‚å¤±è´¥: ${response.status} ${response.statusText}` +
                    (errorData.message ? ` - ${errorData.message}` : ''));
            }

            var result = await response.json();

            // æ ¹æ® standard_response ç»“æ„å¤„ç†ç»“æœ
            if (result.success) {
                await refreshMembers();
                alert("æˆå‘˜ä¿¡æ¯æ›´æ–°æˆåŠŸï¼");
                return true;
            } else {
                console.error("æ›´æ–°æˆå‘˜å¤±è´¥:", result);
                alert(result.message || "æ›´æ–°æˆå‘˜å¤±è´¥");
                return false;
            }
        } catch (err) {
            console.error("æ›´æ–°æˆå‘˜æ—¶å‘ç”Ÿé”™è¯¯:", err);

            // è¯¦ç»†é”™è¯¯å¤„ç†
            let errorMessage = err.message;
            if (errorMessage.includes('JSON') || errorMessage.includes('Unexpected token')) {
                errorMessage = "æœåŠ¡å™¨è¿”å›äº†æ— æ•ˆçš„JSONæ ¼å¼ã€‚è¯·æ£€æŸ¥åç«¯æ˜¯å¦æ­£ç¡®å¯¼å…¥äº†jsonæ¨¡å—ã€‚";
            } else if (errorMessage.includes('404')) {
                errorMessage = "APIç«¯ç‚¹ä¸å­˜åœ¨ã€‚è¯·æ£€æŸ¥åç«¯è·¯ç”±é…ç½®ã€‚";
            }

            alert("æ›´æ–°æˆå‘˜å¤±è´¥: " + errorMessage);
            return false;
        }
    }

    // è°ƒç”¨ /api/member/delete åˆ é™¤æˆå‘˜
    async function deleteMemberById(id) {
        if (!id) {
            console.error("ç¼ºå°‘æˆå‘˜IDï¼Œæ— æ³•åˆ é™¤");
            return false;
        }

        if (!confirm("ç¡®è®¤åˆ é™¤è¿™ä½å›¢é˜Ÿæˆå‘˜å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ï¼")) {
            return false;
        }

        try {
            // è·å–å½“å‰ç”¨æˆ·ID
            var userId = getCurrentUserId();
            if (!userId) {
                alert("æœªæ‰¾åˆ°ç”¨æˆ·IDï¼Œè¯·é‡æ–°ç™»å½•åå†è¯•ã€‚");
                return false;
            }

            var response = await fetch("/api/member/delete", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    id: id,
                    user_id: parseInt(userId, 10) // æ·»åŠ user_id
                })
            });

            if (!response.ok) {
                const errorData = await response.json().catch(() => ({}));
                throw new Error(`è¯·æ±‚å¤±è´¥: ${response.status} ${response.statusText}` +
                    (errorData.message ? ` - ${errorData.message}` : ''));
            }

            var result = await response.json();

            if (result.success) {
                await refreshMembers();
                alert("æˆå‘˜åˆ é™¤æˆåŠŸï¼");
                return true;
            } else {
                console.error("åˆ é™¤æˆå‘˜å¤±è´¥:", result);
                alert(result.message || "åˆ é™¤æˆå‘˜å¤±è´¥");
                return false;
            }
        } catch (err) {
            console.error("åˆ é™¤æˆå‘˜æ—¶å‘ç”Ÿé”™è¯¯:", err);

            // è¯¦ç»†é”™è¯¯å¤„ç†
            let errorMessage = err.message;
            if (errorMessage.includes('JSON') || errorMessage.includes('Unexpected token')) {
                errorMessage = "æœåŠ¡å™¨è¿”å›äº†æ— æ•ˆçš„JSONæ ¼å¼ã€‚è¿™é€šå¸¸è¡¨ç¤ºåç«¯ä»£ç å­˜åœ¨é”™è¯¯ã€‚";
            } else if (errorMessage.includes('403') || errorMessage.includes('æƒé™')) {
                errorMessage = "æ‚¨æ²¡æœ‰æƒé™æ‰§è¡Œæ­¤æ“ä½œã€‚è¯·ç¡®è®¤æ‚¨æ˜¯è¯¥æˆå‘˜çš„æ‰€æœ‰è€…ã€‚";
            }

            alert("åˆ é™¤æˆå‘˜å¤±è´¥: " + errorMessage);
            return false;
        }
    }

    // å›¢é˜Ÿç®¡ç†é¢æ¿å†…äº‹ä»¶ç»‘å®š
    function initTeamManagementEvents() {
        var refreshBtn = document.getElementById("btnRefreshMembers");
        if (refreshBtn) {
            refreshBtn.addEventListener("click", function() {
                refreshMembers();
            });
        }

        var memberForm = document.getElementById("memberForm");
        if (memberForm) {
            memberForm.addEventListener("submit", handleAddMember);
        }

        var memberBoard = document.getElementById("memberBoard");
        if (memberBoard) {
            memberBoard.addEventListener("click", function(event) {
                var target = event.target;

                // å¤„ç†åˆ é™¤æŒ‰é’®ç‚¹å‡»
                if (target.classList.contains("member-delete-btn")) {
                    var id = target.getAttribute("data-id");
                    deleteMemberById(id);
                    return;
                }

                // å¤„ç†å¡ç‰‡ç‚¹å‡» - ç¼–è¾‘æˆå‘˜
                if (target.closest(".member-card")) {
                    var card = target.closest(".member-card");
                    var id = card.getAttribute("data-id");

                    // è·å–å½“å‰å¡ç‰‡ä¸Šçš„æ•°æ®
                    var name = card.querySelector(".member-name").textContent;
                    var techStack = card.querySelector(".member-tech").textContent.replace("æŠ€æœ¯æ ˆ: ", "");

                    // æ–°å¢ï¼šè·å–å››ä¸ªè¯„åˆ†å±æ€§
                    var qualityScore = parseFloat(card.getAttribute("data-quality-score") || "80.0");
                    var workloadScore = parseFloat(card.getAttribute("data-workload-score") || "50.0");
                    var collaborationScore = parseFloat(card.getAttribute("data-collaboration-score") || "80.0");
                    var completionScore = parseFloat(card.getAttribute("data-completion-score") || "0.0");

                    // æ˜¾ç¤ºè‡ªå®šä¹‰ç¼–è¾‘å¯¹è¯æ¡†
                    showEditMemberDialog(id, {
                        name: name,
                        tech_stack: techStack,
                        quality_score: qualityScore,
                        workload_score: workloadScore,
                        collaboration_score: collaborationScore,
                        completion_score: completionScore
                    });
                }
            });
        }
    }

    // æ–°å¢ï¼šæ˜¾ç¤ºç¼–è¾‘æˆå‘˜å¯¹è¯æ¡†
    function showEditMemberDialog(memberId, memberData) {
        // åˆ›å»ºæ¨¡æ€å¯¹è¯æ¡†å®¹å™¨
        const modal = document.createElement('div');
        modal.className = 'modal-overlay';
        modal.innerHTML = `
            <div class="modal-dialog">
                <div class="modal-header">
                    <h3>ç¼–è¾‘å›¢é˜Ÿæˆå‘˜</h3>
                    <button class="close-btn">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label for="editName">å§“å</label>
                        <input type="text" id="editName" class="form-control" value="${memberData.name}">
                    </div>

                    <div class="form-group">
                        <label for="editTechStack">æŠ€æœ¯æ ˆ (ç”¨é€—å·åˆ†éš”)</label>
                        <input type="text" id="editTechStack" class="form-control" value="${memberData.tech_stack || ''}">
                    </div>

                    <div class="form-group">
                        <label for="editWorkload">å·¥ä½œè´Ÿè½½ (1-100)</label>
                        <input type="number" id="editWorkload" class="form-control" min="0" max="100" value="${Math.round(memberData.workload_score)}">
                    </div>

                    <div class="form-group rating-group">
                        <label>è´¨é‡è¯„åˆ†</label>
                        <div class="rating-slider-container">
                            <input type="range" id="qualitySlider" min="0" max="100" value="${Math.round(memberData.quality_score)}" class="rating-slider">
                            <div class="rating-value"><span id="qualityValue">${Math.round(memberData.quality_score)}</span>/100</div>
                            <div class="rating-emoji" id="qualityEmoji">${getEmojiForScore(memberData.quality_score)}</div>
                        </div>
                    </div>

                    <div class="form-group rating-group">
                        <label>åä½œè¯„åˆ†</label>
                        <div class="rating-slider-container">
                            <input type="range" id="collaborationSlider" min="0" max="100" value="${Math.round(memberData.collaboration_score)}" class="rating-slider">
                            <div class="rating-value"><span id="collabValue">${Math.round(memberData.collaboration_score)}</span>/100</div>
                            <div class="rating-emoji" id="collabEmoji">${getEmojiForScore(memberData.collaboration_score)}</div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button id="cancelEdit" class="btn btn-secondary">å–æ¶ˆ</button>
                    <button id="saveEdit" class="btn btn-primary">ä¿å­˜</button>
                </div>
            </div>
        `;

        document.body.appendChild(modal);

        // æ·»åŠ æ ·å¼
        addModalStyles();

        // è·å–å…ƒç´ 
        const closeBtn = modal.querySelector('.close-btn');
        const cancelBtn = modal.querySelector('#cancelEdit');
        const saveBtn = modal.querySelector('#saveEdit');
        const qualitySlider = modal.querySelector('#qualitySlider');
        const collabSlider = modal.querySelector('#collaborationSlider');
        const qualityValue = modal.querySelector('#qualityValue');
        const collabValue = modal.querySelector('#collabValue');
        const qualityEmoji = modal.querySelector('#qualityEmoji');
        const collabEmoji = modal.querySelector('#collabEmoji');

        // å®æ—¶æ›´æ–°è´¨é‡è¯„åˆ†æ˜¾ç¤º
        qualitySlider.addEventListener('input', function() {
            const value = parseInt(this.value);
            qualityValue.textContent = value;
            qualityEmoji.textContent = getEmojiForScore(value);
        });

        // å®æ—¶æ›´æ–°åä½œè¯„åˆ†æ˜¾ç¤º
        collabSlider.addEventListener('input', function() {
            const value = parseInt(this.value);
            collabValue.textContent = value;
            collabEmoji.textContent = getEmojiForScore(value);
        });

        // å…³é—­å¯¹è¯æ¡†
        function closeModal() {
            document.body.removeChild(modal);
        }

        // äº‹ä»¶ç›‘å¬å™¨
        closeBtn.addEventListener('click', closeModal);
        cancelBtn.addEventListener('click', closeModal);

        saveBtn.addEventListener('click', function() {
            // æ”¶é›†è¡¨å•æ•°æ®
            const updatedData = {
                name: modal.querySelector('#editName').value.trim(),
                tech_stack: modal.querySelector('#editTechStack').value.split(',')
                    .map(item => item.trim())
                    .filter(item => item),
                workload_score: parseInt(modal.querySelector('#editWorkload').value) || 0,
                quality_score: parseInt(qualitySlider.value),
                collaboration_score: parseInt(collabSlider.value),
                // ä¿æŒå®Œæˆåº¦è¯„åˆ†ä¸å˜
                completion_score: memberData.completion_score
            };

            // éªŒè¯æ•°æ®
            if (!updatedData.name) {
                alert("å§“åä¸èƒ½ä¸ºç©º");
                return;
            }

            // è°ƒç”¨æ›´æ–°API
            updateMember(memberId, updatedData);
            closeModal();
        });

        // ç‚¹å‡»é®ç½©å±‚å…³é—­
        modal.addEventListener('click', function(e) {
            if (e.target === modal) {
                closeModal();
            }
        });
    }

    // æ–°å¢ï¼šæ ¹æ®è¯„åˆ†è·å–å¯¹åº”çš„è¡¨æƒ…
    function getEmojiForScore(score) {
        if (score >= 80) return 'ğŸ˜„ ä¼˜ç§€';
        if (score >= 60) return 'ğŸ™‚ è‰¯å¥½';
        if (score >= 30) return 'ğŸ˜ ä¸€èˆ¬';
        return 'ğŸ˜ è¾ƒå·®';
    }

    // æ–°å¢ï¼šæ·»åŠ æ¨¡æ€å¯¹è¯æ¡†çš„æ ·å¼
    function addModalStyles() {
        if (document.getElementById('modal-styles')) return;

        const style = document.createElement('style');
        style.id = 'modal-styles';
        style.textContent = `
            .modal-overlay {
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background-color: rgba(0, 0, 0, 0.5);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 1000;
            }

            .modal-dialog {
                background-color: white;
                border-radius: 8px;
                box-shadow: 0 2px 10px rgba(0, 0, 0, 0.15);
                width: 90%;
                max-width: 500px;
                overflow: hidden;
            }

            .modal-header {
                padding: 16px 20px;
                border-bottom: 1px solid #eee;
                display: flex;
                justify-content: space-between;
                align-items: center;
            }

            .modal-header h3 {
                margin: 0;
                font-size: 1.2rem;
                color: #333;
            }

            .close-btn {
                background: none;
                border: none;
                font-size: 1.5rem;
                cursor: pointer;
                color: #999;
            }

            .close-btn:hover {
                color: #333;
            }

            .modal-body {
                padding: 20px;
            }

            .form-group {
                margin-bottom: 16px;
            }

            .form-group label {
                display: block;
                margin-bottom: 6px;
                font-weight: 500;
                color: #444;
            }

            .form-control {
                width: 100%;
                padding: 8px 12px;
                border: 1px solid #ddd;
                border-radius: 4px;
                font-size: 14px;
                box-sizing: border-box;
            }

            .form-control:focus {
                outline: none;
                border-color: #4a90e2;
                box-shadow: 0 0 0 2px rgba(74, 144, 226, 0.2);
            }

            .rating-group {
                margin-top: 10px;
            }

            .rating-slider-container {
                display: flex;
                align-items: center;
                gap: 15px;
            }

            .rating-slider {
                flex: 1;
                height: 8px;
                -webkit-appearance: none;
                background: #e0e0e0;
                border-radius: 4px;
                outline: none;
            }

            .rating-slider::-webkit-slider-thumb {
                -webkit-appearance: none;
                width: 20px;
                height: 20px;
                border-radius: 50%;
                background: #4a90e2;
                cursor: pointer;
                box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            }

            .rating-slider::-moz-range-thumb {
                width: 20px;
                height: 20px;
                border-radius: 50%;
                background: #4a90e2;
                cursor: pointer;
                border: none;
                box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            }

            .rating-value {
                min-width: 50px;
                font-weight: bold;
                color: #4a90e2;
            }

            .rating-emoji {
                min-width: 70px;
                font-size: 1.2rem;
                font-weight: bold;
                text-align: center;
            }

            .modal-footer {
                padding: 12px 20px;
                border-top: 1px solid #eee;
                display: flex;
                justify-content: flex-end;
                gap: 10px;
            }

            .btn {
                padding: 8px 16px;
                border-radius: 4px;
                border: none;
                cursor: pointer;
                font-weight: 500;
                transition: all 0.2s;
            }

            .btn-primary {
                background-color: #4a90e2;
                color: white;
            }

            .btn-primary:hover {
                background-color: #3a7bc8;
            }

            .btn-secondary {
                background-color: #f0f0f0;
                color: #333;
            }

            .btn-secondary:hover {
                background-color: #e0e0e0;
            }
        `;
        document.head.appendChild(style);
    }

    // åˆå§‹åŒ–å›¢é˜Ÿç®¡ç†æ¨¡å—
    document.addEventListener("DOMContentLoaded", function() {
        // æ£€æŸ¥å›¢é˜Ÿç®¡ç†é¢æ¿æ˜¯å¦å­˜åœ¨
        if (document.getElementById("memberBoard")) {
            refreshMembers();
            initTeamManagementEvents();
        }
    });

  </script>


</body>
</html>